#!/bin/sh
set -euo pipefail

# Only operate on staged Swift files
STAGED_SWIFT_FILES="$(git diff --cached --name-only --diff-filter=ACM | grep -E '\.swift$' || true)"
[ -z "$STAGED_SWIFT_FILES" ] && exit 0

# PATH for Homebrew (Apple Silicon + Intel)
export PATH="/opt/homebrew/bin:/usr/local/bin:$PATH"

# Ensure tools
command -v swiftformat >/dev/null 2>&1 || { echo "‚ùå swiftformat not found. Run: brew install swiftformat"; exit 1; }
command -v swiftlint   >/dev/null 2>&1 || { echo "‚ùå swiftlint not found. Run: brew install swiftlint";   exit 1; }

echo "‚ú® SwiftFormat: formatting staged files..."
swiftformat $STAGED_SWIFT_FILES --config .swiftformat

# Re-add any files modified by formatter
echo "$STAGED_SWIFT_FILES" | xargs git add

echo "üîé SwiftLint: linting..."
swiftlint --quiet --strict

echo "‚úÖ Pre-commit passed."
